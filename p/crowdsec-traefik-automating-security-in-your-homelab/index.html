<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Exploring how to utilize Crowdsec with Traefik for enhanced home network security."><title>Crowdsec & Traefik: Automating Security in Your Homelab</title><link rel=canonical href=https://cinderblock.github.io/p/crowdsec-traefik-automating-security-in-your-homelab/><link rel=stylesheet href=/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="Crowdsec & Traefik: Automating Security in Your Homelab"><meta property="og:description" content="Exploring how to utilize Crowdsec with Traefik for enhanced home network security."><meta property="og:url" content="https://cinderblock.github.io/p/crowdsec-traefik-automating-security-in-your-homelab/"><meta property="og:site_name" content="Cinderblock"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="traefik"><meta property="article:tag" content="networking"><meta property="article:tag" content="github"><meta property="article:tag" content="crowdsec"><meta property="article:tag" content="homelab"><meta property="article:published_time" content="2023-06-09T00:00:00+00:00"><meta property="article:modified_time" content="2023-06-09T00:00:00+00:00"><meta property="og:image" content="https://cinderblock.github.io/p/crowdsec-traefik-automating-security-in-your-homelab/crowdsec-traefik.png"><meta name=twitter:title content="Crowdsec & Traefik: Automating Security in Your Homelab"><meta name=twitter:description content="Exploring how to utilize Crowdsec with Traefik for enhanced home network security."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cinderblock.github.io/p/crowdsec-traefik-automating-security-in-your-homelab/crowdsec-traefik.png"><link rel="shortcut icon" href=images/favicon-32x32.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-SJ16DM3169"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SJ16DM3169",{anonymize_ip:!1})}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/Portrait_Austin_hu1b7a0181037ca8e105ddc022cf47b182_5624368_300x0_resize_q75_box.jpg width=300 height=333 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Cinderblock</a></h1><h2 class=site-description>Hey! I'm Austin.</h2></div></header><ol class=social-menu><li><a href=https://www.buymeacoffee.com/cinderblook target=_blank title="Buy Me a Coffee" rel=me><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Buy Me A Coffee</title><path d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723.0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834.0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228.0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185.0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076.0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237.0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704.0 01-4.743.295 37.059 37.059.0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69.0 0011.343.376.483.483.0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484.0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544.0 01-.169.364zm-6.159 3.9c-.862.37-1.84.788-3.109.788a5.884 5.884.0 01-1.569-.217l.877 9.004c.065.78.717 1.38 1.5 1.38.0.0 1.243.065 1.658.065.447.0 1.786-.065 1.786-.065.783.0 1.434-.6 1.499-1.38l.94-9.95a3.996 3.996.0 00-1.322-.238c-.826.0-1.491.284-2.26.613z"/></svg></a></li><li><a href=https://github.com/Cinderblook target=_blank title=GitHub rel=me><svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 .396c-8.839.0-16 7.167-16 16 0 7.073 4.584 13.068 10.937 15.183.803.151 1.093-.344 1.093-.772.0-.38-.009-1.385-.015-2.719-4.453.964-5.391-2.151-5.391-2.151-.729-1.844-1.781-2.339-1.781-2.339-1.448-.989.115-.968.115-.968 1.604.109 2.448 1.645 2.448 1.645 1.427 2.448 3.744 1.74 4.661 1.328.14-1.031.557-1.74 1.011-2.135-3.552-.401-7.287-1.776-7.287-7.907.0-1.751.62-3.177 1.645-4.297-.177-.401-.719-2.031.141-4.235.0.0 1.339-.427 4.4 1.641 1.281-.355 2.641-.532 4-.541 1.36.009 2.719.187 4 .541 3.043-2.068 4.381-1.641 4.381-1.641.859 2.204.317 3.833.161 4.235 1.015 1.12 1.635 2.547 1.635 4.297.0 6.145-3.74 7.5-7.296 7.891.556.479 1.077 1.464 1.077 2.959.0 2.14-.02 3.864-.02 4.385.0.416.28.916 1.104.755 6.4-2.093 10.979-8.093 10.979-15.156.0-8.833-7.161-16-16-16z"/></svg></a></li><li><a href=https://www.instagram.com/austin_barnesz/ target=_blank title=Instagram rel=me><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 551.034 551.034" style="enable-background:new 0 0 551.034 551.034"><g id="XMLID_13_"><linearGradient id="XMLID_2_" gradientUnits="userSpaceOnUse" x1="275.517" y1="4.5714" x2="275.517" y2="549.7202" gradientTransform="matrix(1 0 0 -1 0 554)"><stop offset="0" style="stop-color:#E09B3D"/><stop offset=".3" style="stop-color:#C74C4D"/><stop offset=".6" style="stop-color:#C21975"/><stop offset="1" style="stop-color:#7024C4"/></linearGradient><path id="XMLID_17_" style="fill:url(#XMLID_2_)" d="M386.878.0H164.156C73.64.0.0 73.64.0 164.156v222.722c0 90.516 73.64 164.156 164.156 164.156h222.722c90.516.0 164.156-73.64 164.156-164.156V164.156C551.033 73.64 477.393.0 386.878.0zM495.6 386.878c0 60.045-48.677 108.722-108.722 108.722H164.156c-60.045.0-108.722-48.677-108.722-108.722V164.156c0-60.046 48.677-108.722 108.722-108.722h222.722c60.045.0 108.722 48.676 108.722 108.722V386.878z"/><linearGradient id="XMLID_3_" gradientUnits="userSpaceOnUse" x1="275.517" y1="4.5714" x2="275.517" y2="549.7202" gradientTransform="matrix(1 0 0 -1 0 554)"><stop offset="0" style="stop-color:#E09B3D"/><stop offset=".3" style="stop-color:#C74C4D"/><stop offset=".6" style="stop-color:#C21975"/><stop offset="1" style="stop-color:#7024C4"/></linearGradient><path id="XMLID_81_" style="fill:url(#XMLID_3_)" d="M275.517 133C196.933 133 133 196.933 133 275.516s63.933 142.517 142.517 142.517S418.034 354.1 418.034 275.516 354.101 133 275.517 133zm0 229.6c-48.095.0-87.083-38.988-87.083-87.083s38.989-87.083 87.083-87.083c48.095.0 87.083 38.988 87.083 87.083C362.6 323.611 323.611 362.6 275.517 362.6z"/><linearGradient id="XMLID_4_" gradientUnits="userSpaceOnUse" x1="418.306" y1="4.5714" x2="418.306" y2="549.7202" gradientTransform="matrix(1 0 0 -1 0 554)"><stop offset="0" style="stop-color:#E09B3D"/><stop offset=".3" style="stop-color:#C74C4D"/><stop offset=".6" style="stop-color:#C21975"/><stop offset="1" style="stop-color:#7024C4"/></linearGradient><circle id="XMLID_83_" style="fill:url(#XMLID_4_)" cx="418.306" cy="134.072" r="34.149"/></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a></li><li><a href=https://www.linkedin.com/in/austin-barnes-03869218a/ target=_blank title=linkedin rel=me><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 382 382" style="enable-background:new 0 0 382 382"><path style="fill:#0077b7" d="M347.445.0H34.555C15.471.0.0 15.471.0 34.555v312.889C0 366.529 15.471 382 34.555 382h312.889C366.529 382 382 366.529 382 347.444V34.555C382 15.471 366.529.0 347.445.0zM118.207 329.844c0 5.554-4.502 10.056-10.056 10.056H65.345c-5.554.0-10.056-4.502-10.056-10.056V150.403c0-5.554 4.502-10.056 10.056-10.056h42.806c5.554.0 10.056 4.502 10.056 10.056V329.844zM86.748 123.432c-22.459.0-40.666-18.207-40.666-40.666S64.289 42.1 86.748 42.1s40.666 18.207 40.666 40.666-18.206 40.666-40.666 40.666zM341.91 330.654c0 5.106-4.14 9.246-9.246 9.246H286.73c-5.106.0-9.246-4.14-9.246-9.246v-84.168c0-12.556 3.683-55.021-32.813-55.021-28.309.0-34.051 29.066-35.204 42.11v97.079c0 5.106-4.139 9.246-9.246 9.246h-44.426c-5.106.0-9.246-4.14-9.246-9.246V149.593c0-5.106 4.14-9.246 9.246-9.246h44.426c5.106.0 9.246 4.14 9.246 9.246v15.655c10.497-15.753 26.097-27.912 59.312-27.912 73.552.0 73.131 68.716 73.131 106.472L341.91 330.654z"/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#setting-up-traefik>Setting up Traefik</a><ol><li><a href=#testing-traefik>Testing Traefik</a></li></ol></li><li><a href=#setting-up-crowdsec>Setting up Crowdsec</a><ol><li><a href=#testing-crowdsec>Testing Crowdsec</a></li></ol></li><li><a href=#integrating-crowdsec-and-traefik>Integrating Crowdsec and Traefik</a><ol><li><a href=#automating-updates-with-cron>Automating Updates with Cron</a></li></ol></li><li><a href=#enhancing-crowdsec-with-a-bouncer>Enhancing Crowdsec with a Bouncer</a></li><li><a href=#update-traefik-to-support-the-bouncer>Update Traefik to support the bouncer</a></li><li><a href=#reaping-the-rewards-enrolling-crowdsec>Reaping the Rewards: Enrolling CrowdSec</a><ol><li><a href=#notable-benefits-of-enrolling>Notable benefits of Enrolling:</a></li></ol></li><li><a href=#exploring-more>Exploring More</a></li><li><a href=#useful-crowdsec-commands>Useful Crowdsec commands</a></li><li><a href=#useful-resources>Useful Resources</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/crowdsec-traefik-automating-security-in-your-homelab/><img src=/p/crowdsec-traefik-automating-security-in-your-homelab/crowdsec-traefik_huaa4fe9ac5e5053e41472d3609373499b_395241_800x0_resize_box_3.png srcset="/p/crowdsec-traefik-automating-security-in-your-homelab/crowdsec-traefik_huaa4fe9ac5e5053e41472d3609373499b_395241_800x0_resize_box_3.png 800w, /p/crowdsec-traefik-automating-security-in-your-homelab/crowdsec-traefik_huaa4fe9ac5e5053e41472d3609373499b_395241_1600x0_resize_box_3.png 1600w" width=800 height=434 loading=lazy alt="Featured image of post Crowdsec & Traefik: Automating Security in Your Homelab"></a></div><div class=article-details><header class=article-category><a href=/categories/security/>Security</a>
<a href=/categories/reverse-proxy/ style=background-color:#2a9d8f;color:#fff>Reverse-proxy</a>
<a href=/categories/docker/ style=background-color:#2a9d8f;color:#fff>Docker</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/crowdsec-traefik-automating-security-in-your-homelab/>Crowdsec & Traefik: Automating Security in Your Homelab</a></h2><h3 class=article-subtitle>Exploring how to utilize Crowdsec with Traefik for enhanced home network security.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jun 09, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><h1 id=crowdsec--traefik-automating-security-in-your-homelab>Crowdsec & Traefik: Automating Security in Your Homelab</h1><p>Hello there! Today, I&rsquo;m thrilled to introduce you to <strong>Crowdsec</strong>, an open-source Security threat intelligence project that&rsquo;s perfect for boosting security in your homelab.</p><h2 id=prerequisites>Prerequisites</h2><p>Before we embark on our journey into a safer network, let&rsquo;s check off these prerequisites:</p><ol><li>Prior experience with networking and a good understanding of network protocols.</li><li>Some exposure to Docker as we&rsquo;ll be using Docker-Compose for the setup.</li><li>An external service in your homelab that you&rsquo;re eager to fortify!</li></ol><p>Ready? Let&rsquo;s dive in!</p><h2 id=setting-up-traefik>Setting up Traefik</h2><p>Setting up the Docker container for Traefik is a breeze, provided you have a couple of files handy.</p><blockquote><p>Note: In this setup, we&rsquo;ll be using Cloudflare as the certificate handler via Let&rsquo;s Encrypt. Although I won&rsquo;t go into details on this here, you&rsquo;ll need a domain and API access to your DNS Zones.</p></blockquote><p>First, let&rsquo;s create a directory named <code>traefik</code> and within it, two more directories, <code>logs/</code> and <code>data/</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir traefik
</span></span><span class=line><span class=cl><span class=nb>cd</span> traefik
</span></span><span class=line><span class=cl>mkdir logs/ data/
</span></span></code></pre></td></tr></table></div></div><p>Now, in the traefik directory, create a new docker-compose.yml file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano docker-comopse.yml
</span></span></code></pre></td></tr></table></div></div><p>Input the following configuration:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>traefik</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>traefik:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>traefik</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>security_opt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=kc>no</span>-<span class=l>new-privileges:true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;80:80&#34;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;443:443&#34;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>CF_API_EMAIL=${CF_API_EMAIL}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>CF_API_KEY=${CF_API_KEY}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/etc/localtime:/etc/localtime:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./logs/traefik-access.log:/var/log/traefik</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data/traefik.yml:/traefik.yml:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data/acme.json:/acme.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./data/config.yml:/config.yml:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.enable=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik.entrypoints=http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik.rule=Host(`traefik.domain.com`)&#34;</span><span class=w> </span><span class=c>#Domain-Here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.middlewares.traefik-auth.basicauth.users=${BASICAUTHUSER}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Generate BASID_AUTH_PASS: echo $(htpasswd -nb &#34;&lt;USER&gt;&#34; &#34;&lt;PASSWORD&gt;&#34;) | sed -e s/\\$/\\$\\$/g</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.middlewares.traefik-https-redirect.redirectscheme.scheme=https&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.middlewares.sslheader.headers.customrequestheaders.X-Forwarded-Proto=https&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik.middlewares=traefik-https-redirect&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik-secure.entrypoints=https&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik-secure.rule=Host(`traefik.domain.com`)&#34;</span><span class=w> </span><span class=c>#Domain-Here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik-secure.middlewares=traefik-auth&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik-secure.tls=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik-secure.tls.certresolver=cloudflare&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik-secure.tls.domains[0].main=.domain.com&#34;</span><span class=w> </span><span class=c>#Domain-Here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik-secure.tls.domains[0].sans=*..domain.com&#34;</span><span class=w> </span><span class=c>#Domain-Here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;traefik.http.routers.traefik-secure.service=api@internal&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>proxy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#Ensure to setup docker netowork (`docker network create proxy`)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>With that created, navigate into your data/ directory and create config.yml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> data/
</span></span><span class=line><span class=cl>nano config.yml
</span></span></code></pre></td></tr></table></div></div><p>Fill it with the following: (This will be updated again later; I left a snippet in there about pi-hole, for refernence on how to setup a HTTP / HTTPS router service)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=c>#region routers </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Pihole http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pihole</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>entryPoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Host(`pihole.domain.com`)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>middlewares</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>https-redirectscheme</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>pihole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Pihole https</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pihole-secure</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>entryPoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;https&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Host(`pihole.domain.com`)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>middlewares</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>default-headers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>addprefix-admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>pihole          </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#region services</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>passHostHeader</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Pihole Loadbalancer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pihole</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>loadBalancer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>servers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://pihole-ip-here:80&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>passHostHeader</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#endregion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>middlewares</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Prefix all traffic to admin page</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>addprefix-admin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>addPrefix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/admin&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Redirect all http traffic to https</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>https-redirectscheme</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>redirectScheme</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class=l>https</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>permanent</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Add default headers for redirection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default-headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>frameDeny</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>browserXssFilter</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>contentTypeNosniff</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>forceSTSHeader</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stsIncludeSubdomains</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stsPreload</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>stsSeconds</span><span class=p>:</span><span class=w> </span><span class=m>15552000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>customFrameOptionsValue</span><span class=p>:</span><span class=w> </span><span class=l>SAMEORIGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>customRequestHeaders</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>X-Forwarded-Proto</span><span class=p>:</span><span class=w> </span><span class=l>https</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Whitelist all private IP addresses</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default-whitelist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ipWhiteList</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>sourceRange</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;10.0.0.0/8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;192.168.0.0/16&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;172.16.0.0/12&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Used for headers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>secured</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>chain</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>middlewares</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>default-whitelist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>default-headers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tcp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Whitelist all private IP addresses</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>middlewares</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default-whitelist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ipWhiteList</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>sourceRange</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;10.0.0.0/8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;192.168.0.0/16&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;172.16.0.0/12&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>While still in the same directory, create traefik.yml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano traefik.yml
</span></span></code></pre></td></tr></table></div></div><p>and fill it with:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>api</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dashboard</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>entryPoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;:80&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>redirections</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>entryPoint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>https</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;:443&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>serversTransport</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>insecureSkipVerify</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>providers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>docker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;unix:///var/run/docker.sock&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exposedByDefault</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>filename</span><span class=p>:</span><span class=w> </span><span class=l>/config.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>certificatesResolvers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cloudflare</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>acme</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class=l>${CF_API_EMAIL}</span><span class=w> </span><span class=c># Email of your cloudflare account here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>acme.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>dnsChallenge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>cloudflare</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resolvers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;1.1.1.1:53&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;1.0.0.1:53&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>log</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>INFO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>filePath</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/var/log/traefik/traefik.log&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>accessLog</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>filePath</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/var/log/traefik/access.log&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Now navigate back to the root ./traefik folder, and re-create the container</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ../
</span></span><span class=line><span class=cl>docker-compose up -d --force-recreate
</span></span></code></pre></td></tr></table></div></div><h3 id=testing-traefik>Testing Traefik</h3><p>Don&rsquo;t take any further steps until you are certain traefik is working. Check the the log file, ./traefik/logs/traefik.log with <code>tail -f traefik.log</code> for errors, and work from there.</p><h2 id=setting-up-crowdsec>Setting up Crowdsec</h2><p>With our traefik container running and doing all of its proxy magic, now we can setup our security item. Crowdsec. navigate back to your root folder beneath ./traefik and make a new directory titled crowdsec, with a config/ folder, and a docker-compose.yml file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir crowdsec
</span></span><span class=line><span class=cl><span class=nb>cd</span> crowdsec
</span></span><span class=line><span class=cl>mkdir config
</span></span><span class=line><span class=cl>nano docker-compose.yml
</span></span></code></pre></td></tr></table></div></div><p>Within this docker-compose file put the following for now:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>crowdsec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>crowdsecurity/crowdsec:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>crowdsec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>GID</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;${GID-1000}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>COLLECTIONS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;crowdsecurity/linux crowdsecurity/traefik&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./config/acquis.yaml:/etc/crowdsec/acquis.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./db:/var/lib/crowdsec/data/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./config:/etc/crowdsec/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>../traefik/logs/traefik-access.log:/var/log/traefik/:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># This volume points back to the traefik logs we are writing and storing locally</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8083:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>proxy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Next, create config/acquis.yaml. This houses the config telling Crowdsec to look for the Traefik Logs.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano config/acquis.yml
</span></span></code></pre></td></tr></table></div></div><p>(<em>NOTE: This must be a .yaml and not .yml</em>)
Fill it with the following config:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>filenames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>/var/log/traefik/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>traefik</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>filenames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>/var/log/auth.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>syslog  </span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>While in ./crowdsec, spin it up</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=sb>`</span>docker-compose up -d --force-recreate<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=testing-crowdsec>Testing Crowdsec</h3><p>Again, it is critical you save yourself some time and ensure the service is working as intended before moving forward. Trust me.</p><p>Check first with:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> <span class=sb>`</span>docker <span class=nb>exec</span> crowdsec cscli metrics<span class=sb>`</span>
</span></span></code></pre></td></tr></table></div></div><p>Search for the top of the result, and check that crowdsec can see and is parsing files from <code>/var/log/traefik/</code></p><p>If it is, you can continue! Otherwise look back and just double check syntax and what not.</p><h2 id=integrating-crowdsec-and-traefik>Integrating Crowdsec and Traefik</h2><p>Run a couple of commands into the crowdsec docker container to update it, and bring versioning into line of our collections in use from the docker-compose file, &lsquo;crowdsecurity/linux&rsquo; &lsquo;crowdsecurity/traefik&rsquo;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> crowdsec cscli hub update <span class=o>&amp;&amp;</span> docker <span class=nb>exec</span> crowdsec cscli hub upgrade
</span></span></code></pre></td></tr></table></div></div><p>If you wish, you can automate this, to ensure constant updates between the local crowdsec, and the remote updates from the repos. I&rsquo;ll be keeping it up-to-date by using ansible-semaphore.</p><h3 id=automating-updates-with-cron>Automating Updates with Cron</h3><p>Run the <code>crontab -e</code> command. Select <code>1</code> for /bin/nano, and at the bottom put in</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> <span class=m>0</span> 0,6,12,18 * * * docker <span class=nb>exec</span> crowdsec cscli hub update <span class=o>&amp;&amp;</span> docker <span class=nb>exec</span> crowdsec cscli hub upgrade
</span></span></code></pre></td></tr></table></div></div><p>This will update and upgrade the hub every 6 hours.</p><h2 id=enhancing-crowdsec-with-a-bouncer>Enhancing Crowdsec with a Bouncer</h2><p>We will be using a bouncer designed for traefik (Shout out to: fbonalair for creating this: <a class=link href=https://github.com/fbonalair/traefik-crowdsec-bouncer%29 target=_blank rel=noopener>https://github.com/fbonalair/traefik-crowdsec-bouncer)</a>.</p><p>Go back into your traefik folder, and <code>nano docker-compose.yml</code>, add the following to your file to have it start up right after your crowdsec container:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>  </span><span class=nt>bouncer-traefik</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/fbonalair/traefik-crowdsec-bouncer:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>bouncer-traefik</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>CROWDSEC_BOUNCER_API_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${bouncer-api-key}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Get this api key by running `docker exec crowdsec cscli bouncers add bouncer-traefik`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>CROWDSEC_AGENT_HOST</span><span class=p>:</span><span class=w> </span><span class=l>crowdsec:8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>GIN_MODE</span><span class=p>:</span><span class=w> </span><span class=l>release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;8082:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>proxy</span><span class=w> </span><span class=c># same network as traefik + crowdsec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>crowdsec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Once you have your API key in the file, run <code>docker-compouse up -d --force-recreate</code> and have it create the bouncer.</p><h2 id=update-traefik-to-support-the-bouncer>Update Traefik to support the bouncer</h2><p>Now, navigate back into the Traefik folder and edit the <code>data/config.yml</code> file. Add the following to the <code>http: -> services: -> middlewares:</code> section:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>    </span><span class=nt>crowdsec-bouncer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>forwardauth</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>http://http://bouncer-traefik:8080/api/v1/forwardAuth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>trustForwardHeader</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>You must also add this middleware to your <code>config/traefik.yml</code> file, causing the redirect out to the bouncer at the time of access:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>api</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dashboard</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>entryPoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;:80&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>redirections</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>entryPoint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>to</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>https</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;:443&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>middlewares</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;crowdsec-bouncer@file&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>With that done, run <code>docker-compose up -d --force-recreate</code> for traefik.</p><h2 id=reaping-the-rewards-enrolling-crowdsec>Reaping the Rewards: Enrolling CrowdSec</h2><p>Now that crowdsec is working, lets enroll our client. This will add benefits with a overall a nice dashboard to manage it</p><ul><li>Easily monitoring alerts</li><li>Seeing activity going on</li><li>Bounces occuring</li></ul><ol><li>Navigate to <a class=link href=https://app.crowdsec.net target=_blank rel=noopener>CrowdSec&rsquo;s website</a></li><li>Create an account.</li><li>Search for &lsquo;Enroll your crowdsec security engine!&rsquo; and copy the code at the end of it (see picture below).</li></ol><ul><li><img src=/p/crowdsec-traefik-automating-security-in-your-homelab/crowdsec-traefik-example-01.png width=1167 height=293 srcset="/p/crowdsec-traefik-automating-security-in-your-homelab/crowdsec-traefik-example-01_hu9c6366b7d55d6bb0c6f31d4aa3f7164e_28534_480x0_resize_box_3.png 480w, /p/crowdsec-traefik-automating-security-in-your-homelab/crowdsec-traefik-example-01_hu9c6366b7d55d6bb0c6f31d4aa3f7164e_28534_1024x0_resize_box_3.png 1024w" loading=lazy alt=crowdsec-traefik-01 class=gallery-image data-flex-grow=398 data-flex-basis=955px></li></ul><ol start=4><li>Back on your Crowdsec host, run</li></ol><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> crowdsec cscli console enroll code-pasted-here
</span></span></code></pre></td></tr></table></div></div></li></ul><ol start=5><li>Once pasted, run</li></ol><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker restart crowdsec
</span></span></code></pre></td></tr></table></div></div></li></ul><ol start=6><li>Go back to <a class=link href=https://app.crowdsec.net target=_blank rel=noopener>CrowdSec&rsquo;s website</a> and accept the instance</li><li>Enjoy your management dashboard</li></ol><h3 id=notable-benefits-of-enrolling>Notable benefits of Enrolling:</h3><ul><li>You can receive notifications when your bouncers get updates.</li><li>You have the ability to sync your scenarios across all of your bouncers, making management a breeze.</li></ul><h2 id=exploring-more>Exploring More</h2><p>Interested in taking your security measures to another level?</p><ul><li>Figure out how to add Authelia behind your crowdsec and traefik containers to enhance security a step further with multi-factor web access for your apps. More info <a class=link href=https://www.authelia.com/ target=_blank rel=noopener>here</a>.</li><li>Check out this plugin for Traefik: <a class=link href=https://plugins.traefik.io/plugins/6335346ca4caa9ddeffda116/crowdsec-bouncer-traefik-plugin target=_blank rel=noopener>Crowdsec Bouncer Traefik Plugin</a></li></ul><h2 id=useful-crowdsec-commands>Useful Crowdsec commands</h2><p>To easily execute the following commands, you can use this to exec into your crowdsec container.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it crowdsec /bin/bash
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># See all parsers and scenarios deployed</span>
</span></span><span class=line><span class=cl>cscli hub list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># See all decisions that have occured </span>
</span></span><span class=line><span class=cl>cscli decisions list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># See all alerts at a glance</span>
</span></span><span class=line><span class=cl>cscli alerts list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Block a specific IP</span>
</span></span><span class=line><span class=cl>cscli decisions add --ip 1.2.3.4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Unblock a specific IP</span>
</span></span><span class=line><span class=cl>cscli decisions delete -i 1.2.3.4
</span></span></code></pre></td></tr></table></div></div><h2 id=useful-resources>Useful Resources</h2><p>Here are some useful resources for further exploration:</p><ul><li><a class=link href=https://www.crowdsec.net/ target=_blank rel=noopener>Crowdsec site</a></li><li><a class=link href=https://traefik.io/ target=_blank rel=noopener>Traefik site</a></li><li><a class=link href=https://github.com/fbonalair/traefik-crowdsec-bouncer target=_blank rel=noopener>traefik-crowdsec-bouncer github</a></li><li><a class=link href=https://github.com/Cinderblook/tacklebox/tree/ target=_blank rel=noopener>My GitHub Repository</a></li><li><a class=link href=https://docs.ibracorp.io/crowdsec/ target=_blank rel=noopener>IBRACORP</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/traefik/>traefik</a>
<a href=/tags/networking/>networking</a>
<a href=/tags/github/>github</a>
<a href=/tags/crowdsec/>crowdsec</a>
<a href=/tags/homelab/>homelab</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/rancher-behind-traefik-k3s/><div class=article-image><img src=/p/rancher-behind-traefik-k3s/rancher-traefik.4cb2817ee0774e87050e1dfb693384b3_hu29572413a1d3efce2a3d392c81b7be5f_370473_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post Rancher behind Traefik - K3S" data-hash="md5-TLKBfuB3TocFDh37aTOEsw=="></div><div class=article-details><h2 class=article-title>Rancher behind Traefik - K3S</h2></div></a></article><article class=has-image><a href=/p/ansible-semaphore-automating-updates/><div class=article-image><img src=/p/ansible-semaphore-automating-updates/Ansible-Semaphore.32ae807d310bc47a46a9996da4ce81f7_hu98170f7755439bd9ae64a73233c28b4d_1630110_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post Ansible Semaphore - Automating Updates" data-hash="md5-Mq6AfTELxHpGqZltpM6B9w=="></div><div class=article-details><h2 class=article-title>Ansible Semaphore - Automating Updates</h2></div></a></article><article class=has-image><a href=/p/tacklebox-github-mega-repo/><div class=article-image><img src=/p/tacklebox-github-mega-repo/TackleboxGitHub.c88df2763e4b42c63926b4830b7c0b94_hub0f1b4139f31a5ae230b1c8057d73109_60397_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post TackleBox - GitHub Mega Repo" data-hash="md5-yI3ydj5LQsY5JrSDC3wLlA=="></div><div class=article-details><h2 class=article-title>TackleBox - GitHub Mega Repo</h2></div></a></article><article class=has-image><a href=/p/hugo-gitpage-creating-a-free-website/><div class=article-image><img src=/p/hugo-gitpage-creating-a-free-website/FreeHugoSiteGitPages.9372806199f5d0d2efbde328f9668213_hub4f645c2bd0dad39cb67a0656939c5ed_913322_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post Hugo GitPage - Creating a free website" data-hash="md5-k3KAYZn10NLvveMo+WaCEw=="></div><div class=article-details><h2 class=article-title>Hugo GitPage - Creating a free website</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//cinderblock.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2021 -
2023 Cinderblock</section><section class=powerby>Enthusiastic guy who enjoys the outdoors, flying drones, homelabbing, and of course, all things tech!<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>